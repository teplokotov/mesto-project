(()=>{"use strict";var e={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".btn-save",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"};function t(e,t,o,c){t.forEach((function(t){return n(e,t,c)})),r(t,o)}function n(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}function r(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.removeAttribute("disabled"):t.setAttribute("disabled","disabled")}var o=document.forms.formEdit,c=document.forms.formEditAvatar,u=document.forms.formNewElement,a=document.forms.formConsent,i=o.querySelector(e.submitButtonSelector),s=c.querySelector(e.submitButtonSelector),l=document.querySelector(".btn-edit"),d=document.querySelector(".btn-add"),f=document.querySelector(".elements__list"),m=document.querySelector("#card-template").content.querySelector(".element"),p=document.querySelector(".figure"),v=p.querySelector(".figure__image"),h=p.querySelector(".figure__caption"),y=document.querySelector("#popupShowPhoto"),S=document.querySelector(".info__name"),b=document.querySelector(".info__status"),_=document.querySelector(".avatar"),q=document.querySelector(".profile__avatar"),E=document.querySelector("#profileName"),g=document.querySelector("#profileStatus"),k=document.querySelector("#avatarLink"),L=document.querySelector("#popupEdit"),C=document.querySelector("#popupNewElement"),A=C.querySelector(e.submitButtonSelector),x=document.querySelector("#elementName"),w=document.querySelector("#elementLink"),j=document.querySelector("#popupAvatar"),P=document.querySelector("#popupConsent");function N(e){e.classList.add("popup_opened"),window.addEventListener("keydown",U)}function U(e){"Escape"===e.key&&D(document.querySelector(".popup_opened"))}function D(e){window.removeEventListener("keydown",U),e.classList.remove("popup_opened")}function T(e){D(e.target.closest(".popup"))}var B={baseUrl:"https://nomoreparties.co/v1/plus-cohort-23",headers:{authorization:"f5b55768-3b69-4e12-a737-dd1f60f911ee","Content-Type":"application/json"}};function O(e,t,n,r,o,c,u){var i=function(e,t,n,r,o,c){var u=m.cloneNode(!0),i=u.querySelector(".element__image"),s=u.querySelector(".element__title"),l=u.querySelector(".counter"),d=u.querySelector(".btn-like"),f=u.querySelector(".btn-trash");return i.setAttribute("alt",e),i.setAttribute("src",t),s.textContent=e,0!==n.length&&(l.textContent=n.length,n.find((function(e){return e._id===o}))&&d.classList.toggle("btn-like_liked")),d.addEventListener("click",(function(){var e=d.classList.contains("btn-like_liked")?"DELETE":"PUT";d.classList.toggle("btn-like_liked"),function(e,t){return fetch("".concat(B.baseUrl,"/cards/likes/").concat(e),{method:t,headers:B.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(c,e).then((function(e){return l.textContent=e.likes.length})).catch((function(e){return console.log(e)}))})),o!==r?f.remove():f.addEventListener("click",(function(e){window.addEventListener("keydown",U),N(popupConsent);var t=e.target.closest(".element");a.addEventListener("submit",(function e(n){n.preventDefault(),function(e){return fetch("".concat(B.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:B.headers}).then((function(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))}))}(c).then((function(){return t.remove()})).catch((function(e){return console.log(e)})),T(n),a.removeEventListener("submit",e)}))})),i.addEventListener("click",(function(n){v.setAttribute("alt",e),v.setAttribute("src",t),h.textContent=e,N(y)})),u}(e,t,n,r,o,c);"append"===u?f.append(i):f.prepend(i)}function J(e,t){e?t.classList.contains("btn-create")?t.textContent="Создание...":t.textContent="Сохранение...":t.classList.contains("btn-create")?t.textContent="Создать":t.textContent="Сохранить"}fetch("".concat(B.baseUrl,"/users/me"),{headers:B.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){var t;t=e,S.textContent=t.name,b.textContent=t.about,_.setAttribute("src",t.avatar),_.setAttribute("alt",t.name);var n=e._id;fetch("".concat(B.baseUrl,"/cards"),{headers:B.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return function(e,t){e.forEach((function(e){O(e.name,e.link,e.likes,e.owner._id,t,e._id,"append")}))}(e,n)})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)})),l.addEventListener("click",(function(n){E.value=S.textContent,g.value=b.textContent,t(popupEdit,[E,g],i,e),N(popupEdit)})),o.addEventListener("submit",(function(e){var t,n;e.preventDefault(),J(!0,e.target.querySelector(".form__button")),(t=E.value,n=g.value,fetch("".concat(B.baseUrl,"/users/me"),{method:"PATCH",headers:B.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){S.textContent=e.name,b.textContent=e.about})).catch((function(e){return console.log(e)})).finally((function(){return J(!1,e.target.querySelector(".form__button"))})),T(e)})),u.addEventListener("submit",(function(e){var t,n;e.preventDefault(),J(!0,e.target.querySelector(".form__button")),(t=x.value,n=w.value,fetch("".concat(B.baseUrl,"/cards"),{method:"POST",headers:B.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return e.owner._id?e:Promise.reject("Ошибка: Не найден ID пользователя")}))).then((function(e){return O(e.name,e.link,e.likes,null,null,e._id)})).catch((function(e){return console.log(e)})).finally((function(){return J(!1,e.target.querySelector(".form__button"))})),e.target.reset(),T(e)})),c.addEventListener("submit",(function(e){var t;e.preventDefault(),J(!0,e.target.querySelector(".form__button")),(t=k.value,fetch("".concat(B.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:B.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){return _.setAttribute("src",e.avatar)})).catch((function(e){return console.log(e)})).finally((function(){return J(!1,e.target.querySelector(".form__button"))})),e.target.reset(),T(e)})),[L,C,y,j,P].forEach((function(e){e.addEventListener("click",(function(e){(!e.target.className.includes("form")&&!e.target.className.includes("figure")||e.target.classList.contains("popup__container"))&&T(e)}))})),d.addEventListener("click",(function(){u.reset(),t(popupNewElement,[x,w],A,e),N(popupNewElement)})),q.addEventListener("click",(function(){c.reset(),t(popupAvatar,[k],s,e),N(popupAvatar)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),c=e.querySelector(t.submitButtonSelector);o.forEach((function(u){u.addEventListener("input",(function(){r(o,c),function(e,t,r){t.validity.valid?n(e,t,r):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),t.validity.patternMismatch?o.textContent=t.dataset.errorMessage:o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,r)}(e,u,t)}))}))}(t,e)}))}(e)})();