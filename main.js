(()=>{"use strict";var e={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".btn-save",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"};function t(e,t,o,c){t.forEach((function(t){return n(e,t,c)})),r(t,o)}function n(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}function r(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.removeAttribute("disabled"):t.setAttribute("disabled","disabled")}var o=document.forms.formEdit,c=document.forms.formEditAvatar,u=document.forms.formNewElement,a=document.forms.formConsent,i=o.querySelector(e.submitButtonSelector),l=c.querySelector(e.submitButtonSelector),s=document.querySelector(".btn-edit"),d=document.querySelector(".btn-add"),f=document.querySelector(".elements__list"),m=document.querySelector("#card-template").content.querySelector(".element"),p=document.querySelector(".figure"),v=p.querySelector(".figure__image"),y=p.querySelector(".figure__caption"),b=document.querySelector("#popupShowPhoto"),h=document.querySelector(".info__name"),S=document.querySelector(".info__status"),E=document.querySelector(".avatar"),_=document.querySelector(".profile__avatar"),g=document.querySelector("#profileName"),q=document.querySelector("#profileStatus"),C=document.querySelector("#avatarLink"),L=document.querySelector("#popupEdit"),k=document.querySelector("#popupNewElement"),A=k.querySelector(e.submitButtonSelector),x=document.querySelector("#elementName"),w=document.querySelector("#elementLink"),N=document.querySelector("#popupAvatar"),U=document.querySelector("#popupConsent"),j={};function O(e,t){return fetch(e,t).then(P)}function P(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function T(e){e.classList.add("popup_opened"),window.addEventListener("keydown",D)}function D(e){"Escape"===e.key&&B(document.querySelector(".popup_opened"))}function B(e){window.removeEventListener("keydown",D),e.classList.remove("popup_opened")}function I(e){B(e.target.closest(".popup"))}var M={baseUrl:"https://nomoreparties.co/v1/plus-cohort-23",headers:{authorization:"f5b55768-3b69-4e12-a737-dd1f60f911ee","Content-Type":"application/json"}};function J(e,t,n,r,o,c){var u=m.cloneNode(!0),a=u.querySelector(".element__image"),i=u.querySelector(".element__title"),l=u.querySelector(".counter"),s=u.querySelector(".btn-like"),d=u.querySelector(".btn-trash");return a.setAttribute("alt",e),a.setAttribute("src",t),i.textContent=e,0!==n.length&&(l.textContent=n.length,n.find((function(e){return e._id===o}))&&s.classList.toggle("btn-like_liked")),s.addEventListener("click",(function(){var e=s.classList.contains("btn-like_liked")?"DELETE":"PUT";(function(e,t){return O("".concat(M.baseUrl,"/cards/likes/").concat(e),{method:t,headers:M.headers})})(c,e).then((function(e){l.textContent=e.likes.length>0?e.likes.length:"",s.classList.toggle("btn-like_liked")})).catch((function(e){return console.log(e)}))})),o!==r?d.remove():d.addEventListener("click",(function(e){T(popupConsent),j.findAndRemoveCard=function(){(function(e){return O("".concat(M.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:M.headers})})(c).then((function(){e.target.closest(".element").remove(),B(popupConsent)})).catch((function(e){return console.log(e)}))}})),a.addEventListener("click",(function(n){v.setAttribute("alt",e),v.setAttribute("src",t),y.textContent=e,T(b)})),u}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function R(e,t,n,r,o,c,u){var a=J(e,t,n,r,o,c);"append"===u?f.append(a):f.prepend(a)}function z(e,t){e?t.classList.contains("btn-create")?t.textContent="Создание...":t.textContent="Сохранение...":t.classList.contains("btn-create")?t.textContent="Создать":t.textContent="Сохранить"}Promise.all([O("".concat(M.baseUrl,"/users/me"),{headers:M.headers}),O("".concat(M.baseUrl,"/cards"),{headers:M.headers})]).then((function(e){var t,n,r,o=(r=2,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c,u,a=[],i=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=c.call(n)).done)&&(a.push(r.value),a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{if(!i&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw o}}return a}}(n,r)||function(e,t){if(e){if("string"==typeof e)return H(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?H(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],u=o[1];t=c,h.textContent=t.name,S.textContent=t.about,E.setAttribute("src",t.avatar),E.setAttribute("alt",t.name),function(e,t){e.forEach((function(e){R(e.name,e.link,e.likes,e.owner._id,t,e._id,"append")}))}(u,c._id)})).catch((function(e){return console.log(e)})),s.addEventListener("click",(function(n){g.value=h.textContent,q.value=S.textContent,t(popupEdit,[g,q],i,e),T(popupEdit)})),o.addEventListener("submit",(function(e){var t,n;e.preventDefault(),z(!0,e.submitter),(t=g.value,n=q.value,O("".concat(M.baseUrl,"/users/me"),{method:"PATCH",headers:M.headers,body:JSON.stringify({name:t,about:n})})).then((function(t){h.textContent=t.name,S.textContent=t.about,I(e)})).catch((function(e){return console.log(e)})).finally((function(){return z(!1,e.submitter)}))})),u.addEventListener("submit",(function(e){var t,n;e.preventDefault(),z(!0,e.submitter),(t=x.value,n=w.value,O("".concat(M.baseUrl,"/cards"),{method:"POST",headers:M.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return e.owner._id?e:Promise.reject("Ошибка: Не найден ID пользователя")}))).then((function(t){R(t.name,t.link,t.likes,null,null,t._id),I(e)})).catch((function(e){return console.log(e)})).finally((function(){return z(!1,e.submitter)}))})),c.addEventListener("submit",(function(e){var t;e.preventDefault(),z(!0,e.submitter),(t=C.value,O("".concat(M.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:M.headers,body:JSON.stringify({avatar:t})})).then((function(t){E.setAttribute("src",t.avatar),I(e)})).catch((function(e){return console.log(e)})).finally((function(){return z(!1,e.submitter)}))})),a.addEventListener("submit",(function(e){e.preventDefault(),j.findAndRemoveCard()})),[L,k,b,N,U].forEach((function(e){e.addEventListener("click",(function(e){(!e.target.className.includes("form")&&!e.target.className.includes("figure")||e.target.classList.contains("popup__container"))&&I(e)}))})),d.addEventListener("click",(function(){u.reset(),t(popupNewElement,[x,w],A,e),T(popupNewElement)})),_.addEventListener("click",(function(){c.reset(),t(popupAvatar,[C],l,e),T(popupAvatar)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),c=e.querySelector(t.submitButtonSelector);o.forEach((function(u){u.addEventListener("input",(function(){r(o,c),function(e,t,r){t.validity.valid?n(e,t,r):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),t.validity.patternMismatch?o.textContent=t.dataset.errorMessage:o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,r)}(e,u,t)}))}))}(t,e)}))}(e)})();